<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="style.css">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes" />
<link rel="icon" type="image/x-icon" href="img/favicon.ico">
<!--Nathan A. | W1217574 | 12/09/2020-->
<!--Embedded CSS is for the link to spotify, line 53-->
<title>Death Machine - Music</title>
<style>
   .spotify img {
      width: 200px;
      height: auto;
      margin: 1em auto;
      border: none;
   }
</style>

<body>

   <div id="lightbox" class="lightbox" aria-hidden="true">
      <div class="lightbox-backdrop"></div>

      <div class="lightbox-content">
         <img id="lightbox-img" alt="" hidden>
         <video id="lightbox-video" controls hidden playsinline></video>
      </div>

      <div class="lightbox-hint">Click outside the image to close</div>

   </div>


   <div class="wrapper">
      <header>
         <img src="banner.png" alt="Death Machine" width="1200" height="125" />
         <nav>
            <a href="index.html">Home</a>
            <a href="news.html">News</a>
            <a href="tour.html">Tour</a>
            <a class="active" href="music.html">Music</a>
            <a href="store.html">Store</a>
         </nav>
      </header>
      <div class="content">
         <div class="middle">
            <h1>Music</h1>
            <br />
            <div class="music-player">
               <div class="music-now">
                  <img id="nowCover" class="music-cover" src="2020_album.png" alt="Album art">

                  <div class="music-now-meta">
                     <div class="music-now-label">Now Playing</div>
                     <div id="nowTitle" class="music-now-title">Whispers of the Forest.mp3</div>
                     <div id="nowAlbum" class="music-now-album">MEGALITH</div>
                  </div>

                  <div class="music-controls">
                     <button id="shuffleBtn" class="track-play music-btn" type="button" aria-pressed="false"
                        title="Shuffle">
                        üîÄ
                     </button>

                     <button id="loopBtn" class="track-play music-btn" type="button" data-loop="off" title="Loop: Off">
                        üîÅ
                     </button>
                  </div>
               </div>
               <audio id="mainPlayer" controls preload="metadata">
                  <source id="mainSource" src="music/Whispers of the Forest.mp3" type="audio/mpeg">
                  Your browser does not support the audio element.
               </audio>

               <div class="tracklist" role="list">
                  <div class="track-row  is-active" data-src="music/Whispers of the Forest.mp3" data-type="audio/mpeg"
                     data-title="Whispers of the Forest" data-album="MEGALITH" data-cover="2020_album.png">
                     <button class="track-play" type="button">‚ñ∂</button>
                     <div class="track-title">MEGALITH - Whispers of the Forest</div>
                  </div>

                  <div class="track-row" data-src="music/If I Must.mp3" data-type="audio/mpeg" data-title="If I Must"
                     data-album="MEGALITH" data-cover="2020_album.png">
                     <button class="track-play" type="button">‚ñ∂</button>
                     <div class="track-title">MEGALITH - If I Must</div>
                  </div>

                  <div class="track-row" data-src="music/Left Alone.mp3" data-type="audio/mpeg" data-title="Left Alone"
                     data-album="MEGALITH" data-cover="2020_album.png">
                     <button class="track-play" type="button">‚ñ∂</button>
                     <div class="track-title">MEGALITH - Left Alone</div>
                  </div>

                  <div class="track-row" data-src="music/My Regrets.mp3" data-type="audio/mpeg" data-title="My Regrets"
                     data-album="MEGALITH" data-cover="2020_album.png">
                     <button class="track-play" type="button">‚ñ∂</button>
                     <div class="track-title">MEGALITH - My Regrets</div>
                  </div>

                  <div class="track-row" data-src="music/Please Stay.mp3" data-type="audio/mpeg"
                     data-title="Please Stay" data-album="MEGALITH" data-cover="2020_album.png">
                     <button class="track-play" type="button">‚ñ∂</button>
                     <div class="track-title">MEGALITH - Please Stay</div>
                  </div>

                  <div class="track-row" data-src="music/Skeletons.mp3" data-type="audio/mpeg" data-title="Skeletons"
                     data-album="MEGALITH" data-cover="2020_album.png">
                     <button class="track-play" type="button">‚ñ∂</button>
                     <div class="track-title">MEGALITH - Skeletons</div>
                  </div>

                  <div class="track-row" data-src="music/All in your head.m4a" data-type="audio/mpeg"
                     data-title="All in your head." data-album="All in your head." data-cover="2013_album.png">
                     <button class="track-play" type="button">‚ñ∂</button>
                     <div class="track-title">All in your head. - All in your head.</div>
                  </div>

                  <!-- Add more tracks by duplicating a .track-row block -->

               </div>

               <p style="margin-top: 12px;">Thank you for listening!</p>
            </div>





            <br /><br />
            <div class="music">
               <!--I made all of these albums with illustrator and photoshop-->
               <div class="album"><a href="2011_album.png" class="lightbox-trigger"><img src="2011_album.png"
                        alt="Suicidal Death Machine - 2011" width="1000" height="1000" /></a></div>
               <div class="album"><a href="2012_album.png" class="lightbox-trigger"><img src="2012_album.png"
                        alt="Death Machine - Mechanic God Creation - 2012" width="1000" height="1000" /></a></div>
               <div class="album"><a href="2013_album.png" class="lightbox-trigger"><img src="2013_album.png"
                        alt="Death Machine - All in your head. - 2013" width="1000" height="1000" /></a></div>
               <div class="album"><a href="2015_album.png" class="lightbox-trigger"><img src="2015_album.png"
                        alt="Death Machine - Believe - 2015" width="1000" height="1000" /></a></div>
               <div class="album"><a href="2017_album.png" class="lightbox-trigger"><img src="2017_album.png"
                        alt="Death Machine - Slaughter - 2017" width="1000" height="1000" /></a></div>
               <div class="album"><a href="2020_album.png" class="lightbox-trigger"><img src="2020_album.png"
                        alt="Death Machine - Megalith - 2020" width="1000" height="1000" /></a></div>
            </div>
            <div class="spotify"><a href="https://open.spotify.com/search/" target="_blank"><img src="spotifybutton.png"
                     alt="Listen on Spotify!" width="1081" height="396" /></a></div>
         </div>
      </div>
      <footer>
         Copyright <a href="../index.html">Death Machine</a> 2022 &copy;
         <small>Fictional band website created as a school project. Not an actual band.</small>
      </footer>
   </div>
   <a href="https://nathanarcuri.com/projects.html#school"
      style="position:fixed;top:12px;left:12px;z-index:9999;padding:8px 14px;background:#111;color:#fff;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,.4);">‚Üê
      Projects</a>


   <script>
      (function () {
         /* =========================Music Player (next, shuffle, loop)========================= */
         const player = document.getElementById("mainPlayer");
         const source = document.getElementById("mainSource");
         const nowTitle = document.getElementById("nowTitle");
         const nowAlbum = document.getElementById("nowAlbum");
         const nowCover = document.getElementById("nowCover");

         const shuffleBtn = document.getElementById("shuffleBtn");
         const loopBtn = document.getElementById("loopBtn");

         const rows = Array.from(document.querySelectorAll(".track-row"));

         let currentIndex = 0;
         let shuffleOn = false;          // true = random next
         let loopMode = "off";           // "off" | "all" | "one"

         // Find initial index from the row that has is-active, else 0
         const initialActive = rows.findIndex(r => r.classList.contains("is-active"));
         currentIndex = initialActive >= 0 ? initialActive : 0;

         function setActiveRow(activeRow) {
            rows.forEach(r => r.classList.remove("is-active"));
            if (activeRow) activeRow.classList.add("is-active");
         }

         function applyNowPlayingFromRow(row) {
            if (!row) return;

            const title = row.dataset.title;
            const album = row.dataset.album;
            const cover = row.dataset.cover;

            if (nowTitle) nowTitle.textContent = title || "Now Playing";
            if (nowAlbum) nowAlbum.textContent = album || "";
            if (nowCover) nowCover.src = cover || (nowCover.getAttribute("src") || "");
         }

         function loadTrackByIndex(index, autoplay = true) {
            if (!player || !source || !rows.length) return;

            if (index < 0) index = 0;
            if (index >= rows.length) index = rows.length - 1;

            currentIndex = index;
            const row = rows[currentIndex];
            if (!row) return;

            const src = row.dataset.src;
            const type = row.dataset.type;

            if (!src) return;

            applyNowPlayingFromRow(row);

            source.src = src;
            source.type = type || "";
            player.load();

            if (autoplay) player.play().catch(() => { });
            setActiveRow(row);
         }

         function pickNextIndex() {
            if (!rows.length) return 0;

            // Loop One means "same track again"
            if (loopMode === "one") return currentIndex;

            if (shuffleOn) {
               if (rows.length === 1) return 0;

               let next = currentIndex;
               while (next === currentIndex) {
                  next = Math.floor(Math.random() * rows.length);
               }
               return next;
            }

            // Normal sequential
            const next = currentIndex + 1;

            if (next < rows.length) return next;

            // End of list
            if (loopMode === "all") return 0;

            // Loop off: stay at end and stop
            return currentIndex;
         }

         function handleEnded() {
            if (!rows.length) return;

            const nextIndex = pickNextIndex();

            // If loop is off and we're at the end, do nothing
            if (loopMode === "off" && !shuffleOn && nextIndex === currentIndex && currentIndex === rows.length - 1) {
               return;
            }

            loadTrackByIndex(nextIndex, true);
         }

         function updateControlsUI() {
            if (shuffleBtn) {
               shuffleBtn.classList.toggle("is-on", shuffleOn);
               shuffleBtn.setAttribute("aria-pressed", shuffleOn ? "true" : "false");
               shuffleBtn.title = shuffleOn ? "Shuffle: On" : "Shuffle: Off";
            }

            if (loopBtn) {
               loopBtn.classList.toggle("is-on", loopMode !== "off");
               loopBtn.dataset.loop = loopMode;

               if (loopMode === "off") {
                  loopBtn.textContent = "üîÅ";
                  loopBtn.classList.remove("loop-one");
                  loopBtn.title = "Loop: Off";
               }
               else if (loopMode === "all") {
                  loopBtn.textContent = "üîÅ";
                  loopBtn.classList.remove("loop-one");
                  loopBtn.title = "Loop: All";
               }
               else {
                  loopBtn.textContent = "üîÇ";
                  loopBtn.classList.add("loop-one");
                  loopBtn.title = "Loop: One";
               }
            }
         }

         // Wire up row clicks
         rows.forEach((row, idx) => {
            const playBtn = row.querySelector(".track-play");
            const titleEl = row.querySelector(".track-title");

            if (playBtn) {
               playBtn.addEventListener("click", (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  loadTrackByIndex(idx, true);
               });
            }

            if (titleEl) {
               titleEl.addEventListener("click", (e) => {
                  e.preventDefault();
                  loadTrackByIndex(idx, true);
               });
            }

            row.addEventListener("click", (e) => {
               if (e.target.closest("button") || e.target.closest("a")) return;
               loadTrackByIndex(idx, true);
            });
         });

         // Buttons
         if (shuffleBtn) {
            shuffleBtn.addEventListener("click", () => {
               shuffleOn = !shuffleOn;
               updateControlsUI();
            });
         }

         if (loopBtn) {
            loopBtn.addEventListener("click", () => {
               // cycle: off -> all -> one -> off
               loopMode = loopMode === "off" ? "all" : loopMode === "all" ? "one" : "off";
               updateControlsUI();
            });
         }

         // Auto advance
         if (player) {
            player.addEventListener("ended", handleEnded);
         }

         // Init UI + load initial active track (no autoplay)
         updateControlsUI();
         loadTrackByIndex(currentIndex, false);


         /* =========================Lightbox Vars========================= */
         const lightbox = document.getElementById("lightbox");
         const img = document.getElementById("lightbox-img");
         const video = document.getElementById("lightbox-video");
         const backdrop = lightbox ? lightbox.querySelector(".lightbox-backdrop") : null;
         if (!lightbox || !img || !video || !backdrop) return;

         function isVideoUrl(src) {
            try {
               const clean = src.split("#")[0].split("?")[0];
               return /\.(mp4|webm|ogg)$/i.test(clean);
            } catch {
               return false;
            }
         }

         function resetMedia() {
            img.hidden = true;
            img.src = "";

            video.hidden = true;
            video.pause();
            video.removeAttribute("src");
            video.load();
         }

         function openLightbox(src) {
            resetMedia();

            if (isVideoUrl(src)) {
               video.src = src;
               video.hidden = false;
               video.load();
               video.play().catch(() => { });
            } else {
               img.src = src;
               img.hidden = false;
            }

            lightbox.classList.add("is-open");
            lightbox.setAttribute("aria-hidden", "false");
         }

         function closeLightbox() {
            lightbox.classList.remove("is-open");
            lightbox.setAttribute("aria-hidden", "true");
            resetMedia();
         }

         document.addEventListener("click", e => {
            const trigger = e.target.closest(".lightbox-trigger");
            if (!trigger) return;

            const href = trigger.getAttribute("href");
            if (!href) return;

            e.preventDefault();
            openLightbox(href);
         });

         backdrop.addEventListener("click", closeLightbox);

         document.addEventListener("keydown", e => {
            if (e.key === "Escape" && lightbox.classList.contains("is-open")) {
               closeLightbox();
            }
         });
      })();
   </script>

</body>

</html>